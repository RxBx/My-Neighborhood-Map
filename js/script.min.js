"use strict";var ViewModel=function(){var e=this;this.Place=function(e){this.name=e.name,this.address1=e.address1,this.city=e.city,this.access=e.access,this.architect=e.architect,this.caseStudy=e["Case Study"],this.year=e.year,this.marker=new google.maps.Marker({position:null,map:null,title:e.name}),this.exhibit=ko.observable(!0),this.searchString=function(){var t=e.name+e.address1+e.city+e.architect+e.year;return e.caseStudy===!0&&(t+="caseStudy"),t=t.toLowerCase()}()},this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.05,lng:-118.25},zoom:8,streetViewControl:!1,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}}),this.markerBounds=new google.maps.LatLngBounds,this.infowindow=new google.maps.InfoWindow({content:""}),this.placeList=ko.observableArray([]),this.listScroll=ko.observable(!1),this.listScrollEval=function(){var t=$("#overlay-list_listContents ul").outerHeight(!0),s=$("#overlay-list_listContents").height();t>s?e.listScroll(!0):e.listScroll(!1)},this.noResults=ko.observable(!1),this.noResultsEval=function(){var t=$("#mainView__overlay-list_listContents_ul li").length,s=$("#mainView__overlay-list_listContents_ul li:hidden").length;s===t?e.noResults(!0):e.noResults(!1)},this.decades=ko.observableArray([]),this.decades1920=ko.observable(!1),this.decades1930=ko.observable(!1),this.decades1940=ko.observable(!1),this.decades1950=ko.observable(!1),this.decades1960=ko.observable(!1),this.decades1970=ko.observable(!1),this.decades1980=ko.observable(!1),this.decades1990=ko.observable(!1),this.decades2000=ko.observable(!1),this.architect=ko.observableArray([]),this.wright=ko.observable(!1),this.schindler=ko.observable(!1),this.neutra=ko.observable(!1),this.lautner=ko.observable(!1),this.gehry=ko.observable(!1),this.caseStudy=ko.observable(!1),this.access=ko.observableArray([]),this["public"]=ko.observable(!1),this.tours=ko.observable(!1),this.exterior=ko.observable(!1),this["private"]=ko.observable(!1),this.search=ko.observable(""),this.evaluateExhibit=function(){e.placeList().forEach(function(e){null!==e.marker.getAnimation()&&e.marker.setAnimation(null)}),e.placeList().forEach(function(t){if(t.exhibit(!1),e.access().length>0)for(var s=0,i=e.access().length;i>s;s++)t.access!==e.access()[s]&&t.exhibit()===!1?t.exhibit(!1):t.exhibit(!0);else t.exhibit(!0);if(e.evalCsIgnoreAr=function(e){e.caseStudy===!0?e.exhibit(!0):e.exhibit(!1)},e.evalArIgnoreCs=function(t){t.exhibit(!1);var s=!1;e.architect().forEach(function(e){t.architect.indexOf(e)>-1&&s!==!0&&(s=!0)}),s===!0&&t.exhibit(!0)},t.exhibit()===!0&&(e.caseStudy()===!0&&0===e.architect().length?e.evalCsIgnoreAr(t):e.caseStudy()===!1&&e.architect().length>0?e.evalArIgnoreCs(t):e.caseStudy()===!0&&e.architect().length>0&&(e.evalCsIgnoreAr(t),t.exhibit()===!1&&e.evalArIgnoreCs(t))),t.exhibit()===!0&&e.decades().length>0){t.exhibit(!1);for(var a=!1,o=10*Math.floor(t.year/10),s=0,i=e.decades().length;i>s;s++){var r=e.decades()[s];(r==o||a===!0)&&(a=!0)}a===!0&&t.exhibit(!0)}e.search()!==!1&&t.exhibit()===!0?t.searchString.indexOf(e.search().toLowerCase())>-1?t.exhibit(!0):t.exhibit(!1):""===e.search()&&t.exhibit()===!0&&t.exhibit(!0)}),e.listScrollEval(),e.noResultsEval(),e.infowindow.close(),e.markerBounds=new google.maps.LatLngBounds,e.setMarkers(),e.map.getZoom()>11&&e.map.setZoom(11)},this.sortPlaces=function(t){t.forEach(function(t){e.placeList().push(new e.Place(t))})},this.setMarkers=function(){e.placeList().forEach(e.markerSpinner)},this.geocode=function(t){for(var s="https://maps.googleapis.com/maps/api/geocode/json",i="AIzaSyBkBk3maFmugZtnSWKTkFMK2CXIe0c_20k",a=t.address1,o=t.city,r=a.split(" "),n=r[0],c=1,l=r.length;l>c;c++)n+="+"+r[c];var d=n+",+"+o+",+CA",h={address:d,key:i},u=setTimeout(function(){$("#error").text("Error: Google Map Geocoder is failing to connect").removeClass("noerror").addClass("error")},3e3);$.getJSON(s,h,function(s){var i;if("OK"===s.status)clearTimeout(u),i=s.results[0].geometry.location,t.marker.setPosition(i),t.marker.addListener("click",function(){e.infoWindowOpener(t)});else if("OVER_QUERY_LIMIT"===s.status)clearTimeout(u),e.geocode(t);else{clearTimeout(u);setTimeout(function(){$("#error").removeClass("error").addClass("noerror")},8e3);$("#error").text("Error: Google Map Geocoder failed on at least one address lookup. Message: "+s.status).removeClass("noerror").addClass("error")}t.exhibit()===!0&&null!==t.marker.getPosition()&&(t.marker.setMap(e.map),e.markerBounds.extend(t.marker.getPosition()),e.map.fitBounds(e.markerBounds),e.map.getZoom()>11&&e.map.setZoom(11))})},this.markerSpinner=function(t){t.exhibit()===!0&&null===t.marker.getPosition()?e.geocode(t):t.exhibit()===!0?(e.markerBounds.extend(t.marker.getPosition()),t.marker.setMap(e.map),e.map.fitBounds(e.markerBounds),e.map.panToBounds(e.markerBounds)):t.marker.setMap(null)},this.infoWindowOpener=function(t){e.placeList().forEach(function(e){null!==e.marker.getAnimation()&&e.marker.setAnimation(null)}),e.infowindow.close(),t.marker.setAnimation(google.maps.Animation.BOUNCE);var s=t.access,i=function(e){return"e"===e?"Exterior View":"o"===e?"Public Access":"t"===e?"Access via Tours/Appointments":"p"===e?"Private Residence - No Access":void 0},a=i(s),o=function(e){return e.caseStudy===!0&&"Richard Neutra"!==e.architect?"Case Study Houses":e.architect},r=o(t),n="http://en.wikipedia.org/w/api.php",c=setTimeout(function(){var s="<p>"+t.name+"</p><p>"+t.address1+", "+t.city+"</p><p>Year Built: "+t.year+"</p><p>Architect(s): "+t.architect+"</p><p>"+a+"</p>(Wikipedia is not responding)";e.infowindow.setContent(s),e.infowindow.open(e.map,t.marker)},3e3);$.ajax({url:n,data:{action:"opensearch",search:r,namespace:0},dataType:"jsonp"}).done(function(s){clearTimeout(c);var i=s,o='<p><a href="'+i[3][0]+'" target="_blank">Wikipedia link</a></p>',r="<p>"+t.name+"</p><p>"+t.address1+", "+t.city+"</p><p>Year Built: "+t.year+"</p><p>Architect(s): "+t.architect+"</p><p>"+a+"</p>"+o;e.infowindow.setContent(r),e.infowindow.open(e.map,t.marker)}).fail(function(s){clearTimeout(c);var i="<p>"+t.name+"</p><p>"+t.address1+", "+t.city+"</p><p>Year Built: "+t.year+"</p><p>Architect(s): "+t.architect+"</p><p>"+a+"</p>";e.infowindow.setContent(i),e.infowindow.open(e.map,t.marker)})},this.showAll=function(){e.decades([]),e.architect([]),e.caseStudy(!1),e.access([]),e.search("")},this.clearMap=function(){e.showAll(),e.placeList().forEach(function(e){e.exhibit(!1)}),e.listScroll(!1),e.noResults(!0),e.setMarkers()},this.isMobileLandscape=function(){return window.innerWidth<651&&window.innerHeight<window.innerWidth?!0:!1},this.toggleSelections=function(){e.isMobileLandscape()===!1&&$("#selections").position().top===window.innerHeight/2?($("#selections").animate({top:"100%"},250),$("#searchFilterRevealHide").css({"background-color":"#e6e87e"}),$("#searchFilterRevealHideText").text("Search/Filters")):e.isMobileLandscape()===!1?($("#selections").animate({top:"50%"},250),$("#searchFilterRevealHide").css({"background-color":"#8cdcda"}),$("#searchFilterRevealHideText").text("See List")):e.isMobileLandscape()===!0&&$("#selections").position().top<.11*window.innerHeight?($("#searchFilterRevealHideText").text("Search/Filters"),$("#selections").animate({top:"92.5%"},250),$("#searchFilterRevealHide").css({"background-color":"#e6e87e"})):e.isMobileLandscape()===!0&&$("#selections").position().top>.11*window.innerHeight&&($("#searchFilterRevealHideText").text("See List"),$("#selections").animate({top:"10%"},250),$("#searchFilterRevealHide").css({"background-color":"#8cdcda"}))},this.updateStyleDecade=function(){e.decades1920(!1),e.decades1930(!1),e.decades1940(!1),e.decades1950(!1),e.decades1960(!1),e.decades1970(!1),e.decades1980(!1),e.decades1990(!1),e.decades2000(!1);for(var t=0,s=e.decades().length;s>t;t++){var i=e.decades()[t];1920==i?e.decades1920(!0):1930==i?e.decades1930(!0):1940==i?e.decades1940(!0):1950==i?e.decades1950(!0):1960==i?e.decades1960(!0):1970==i?e.decades1970(!0):1980==i?e.decades1980(!0):1990==i?e.decades1990(!0):2e3==i&&e.decades2000(!0)}},e.decades.subscribe(e.updateStyleDecade),this.updateStyleArchitect=function(){e.wright(!1),e.schindler(!1),e.neutra(!1),e.lautner(!1),e.gehry(!1);for(var t=0,s=e.architect().length;s>t;t++){var i=e.architect()[t];"Frank Lloyd Wright"===i?e.wright(!0):"Schindler"===i?e.schindler(!0):"Neutra"===i?e.neutra(!0):"Lautner"===i?e.lautner(!0):"Gehry"===i&&e.gehry(!0)}},e.architect.subscribe(e.updateStyleArchitect),this.updateStyleAccess=function(){e["public"](!1),e.tours(!1),e.exterior(!1),e["private"](!1);for(var t=0,s=e.access().length;s>t;t++){var i=e.access()[t];"o"===i?e["public"](!0):"t"===i?e.tours(!0):"e"===i?e.exterior(!0):"p"===i&&e["private"](!0)}},e.access.subscribe(e.updateStyleAccess),e.decades.subscribe(e.evaluateExhibit),e.caseStudy.subscribe(e.evaluateExhibit),e.architect.subscribe(e.evaluateExhibit),e.access.subscribe(e.evaluateExhibit),e.search.subscribe(e.evaluateExhibit),window.addEventListener("orientationchange",function(){e.isMobileLandscape()===!0?($("#searchFilterRevealHideText").text("Search/Filters"),$("#selections").css({top:"100%"}),$("#searchFilterRevealHide").css({"background-color":"#e6e87e"})):window.innerWidth<651&&($("#searchFilterRevealHideText").text("See List"),$("#selections").css({top:"50%"}),$("#searchFilterRevealHide").css({"background-color":"#8cdcda"})),e.map.fitBounds(e.markerBounds),e.map.getZoom()>11&&e.map.setZoom(11)}),window.addEventListener("resize",function(){e.isMobileLandscape()===!0?($("#searchFilterRevealHideText").text("Search/Filters"),$("#selections").css({top:"100%"}),$("#searchFilterRevealHide").css({"background-color":"#e6e87e"})):window.innerWidth<651&&($("#searchFilterRevealHideText").text("See List"),$("#selections").css({top:"50%"}),$("#searchFilterRevealHide").css({"background-color":"#8cdcda"})),e.map.fitBounds(e.markerBounds),e.map.getZoom()>11&&e.map.setZoom(11)}),e.sortPlaces(masterList),e.access(["o","t","e"]),setTimeout(function(){e.listScrollEval()},100)},startApp=function(){ko.applyBindings(new ViewModel)},errorCall=function(){var e=document.createElement("p");if(document.body)$("#error").text("Error: Google Map API failed to load").removeClass("noerror").addClass("error");else{var t=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),s=t.createElement("body");t.documentElement.appendChild(s),setTimeout(function(){document.body.appendChild(e),$("p").attr("id","error"),$("#error").text("Error: Google Map API failed to load").removeClass("noerror").addClass("error")},0)}};