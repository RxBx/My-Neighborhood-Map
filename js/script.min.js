"use strict";var ViewModel=function(){var e=this;e.Place=function(t){this.name=t.name,this.address1=t.address1,this.city=t.city,this.access=t.access,this.architect=t.architect,this.caseStudy=t["Case Study"],this.year=t.year,this.marker=new google.maps.Marker({position:null,map:e.map,title:t.name,visible:!1}),this.exhibit=ko.observable(!0),this.searchString=function(){var e=t.name+t.address1+t.city+t.architect+t.year;return t.caseStudy===!0&&(e+="caseStudy"),e=e.toLowerCase()}()},e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.05,lng:-118.25},zoom:8,streetViewControl:!1,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}}),e.markerBounds=new google.maps.LatLngBounds,e.infowindow=new google.maps.InfoWindow({content:""}),e.error=ko.observable(!1),e.errorMessage=ko.observable(""),e.placeList=ko.observableArray([]),e.listScroll=ko.observable(!1),e.listScrollEval=function(){var t=$("#overlay-list_listContents ul").outerHeight(!0),a=$("#overlay-list_listContents").height();t>a?e.listScroll(!0):e.listScroll(!1)},e.noResults=ko.observable(!1),e.noResultsEval=function(){var t=$("#mainView__overlay-list_listContents_ul li").length,a=$("#mainView__overlay-list_listContents_ul li:hidden").length;a===t?e.noResults(!0):e.noResults(!1)},e.decades=ko.observableArray([]),e.decades1920=ko.observable(!1),e.decades1930=ko.observable(!1),e.decades1940=ko.observable(!1),e.decades1950=ko.observable(!1),e.decades1960=ko.observable(!1),e.decades1970=ko.observable(!1),e.decades1980=ko.observable(!1),e.decades1990=ko.observable(!1),e.decades2000=ko.observable(!1),e.architect=ko.observableArray([]),e.wright=ko.observable(!1),e.schindler=ko.observable(!1),e.neutra=ko.observable(!1),e.lautner=ko.observable(!1),e.gehry=ko.observable(!1),e.caseStudy=ko.observable(!1),e.access=ko.observableArray([]),e["public"]=ko.observable(!1),e.tours=ko.observable(!1),e.exterior=ko.observable(!1),e["private"]=ko.observable(!1),e.search=ko.observable(""),e.evaluateExhibit=function(){e.placeList().forEach(function(e){null!==e.marker.getAnimation()&&e.marker.setAnimation(null)}),e.placeList().forEach(function(t){if(t.exhibit(!1),e.access().length>0)for(var a=0,o=e.access().length;o>a;a++)t.access!==e.access()[a]&&t.exhibit()===!1?t.exhibit(!1):t.exhibit(!0);else t.exhibit(!0);if(e.evalCsIgnoreAr=function(e){e.caseStudy===!0?e.exhibit(!0):e.exhibit(!1)},e.evalArIgnoreCs=function(t){t.exhibit(!1);var a=!1;e.architect().forEach(function(e){t.architect.indexOf(e)>-1&&a!==!0&&(a=!0)}),a===!0&&t.exhibit(!0)},t.exhibit()===!0&&(e.caseStudy()===!0&&0===e.architect().length?e.evalCsIgnoreAr(t):e.caseStudy()===!1&&e.architect().length>0?e.evalArIgnoreCs(t):e.caseStudy()===!0&&e.architect().length>0&&(e.evalCsIgnoreAr(t),t.exhibit()===!1&&e.evalArIgnoreCs(t))),t.exhibit()===!0&&e.decades().length>0){t.exhibit(!1);for(var i=!1,s=10*Math.floor(t.year/10),a=0,o=e.decades().length;o>a;a++){var r=e.decades()[a];(r==s||i===!0)&&(i=!0)}i===!0&&t.exhibit(!0)}e.search()!==!1&&t.exhibit()===!0?t.searchString.indexOf(e.search().toLowerCase())>-1?t.exhibit(!0):t.exhibit(!1):""===e.search()&&t.exhibit()===!0&&t.exhibit(!0)}),e.listScrollEval(),e.noResultsEval(),e.infowindow.close(),e.markerBounds=new google.maps.LatLngBounds,e.setMarkers(),e.map.getZoom()>11&&e.map.setZoom(11)},e.sortPlaces=function(t){for(var a=t.length,o=0;a>o;o++)e.placeList().push(new e.Place(t[o]));e.firstRun()},e.setMarkers=function(){e.placeList().forEach(e.markerSpinner)},e.geocode=function(t){for(var a="https://maps.googleapis.com/maps/api/geocode/json",o="AIzaSyBkBk3maFmugZtnSWKTkFMK2CXIe0c_20k",i=t.address1,s=t.city,r=i.split(" "),n=r[0],c=1,l=r.length;l>c;c++)n+="+"+r[c];var d=n+",+"+s+",+CA",u={address:d,key:o},p=setTimeout(function(){e.error(!0),e.errorMessage("Error: Google Map Geocoder is failing to connect")},3e3);$.getJSON(a,u,function(a){var o;"OK"===a.status?(clearTimeout(p),o=a.results[0].geometry.location,t.marker.setPosition(o),t.marker.addListener("click",function(){e.infoWindowOpener(t)})):"OVER_QUERY_LIMIT"===a.status?(clearTimeout(p),e.geocode(t)):(clearTimeout(p),e.error(!0),e.errorMessage("Error: Google Map Geocoder failed on at least one address lookup. Message: "+a.status)),t.exhibit()===!0&&null!==t.marker.getPosition()&&(t.marker.setVisible(!0),e.markerBounds.extend(t.marker.getPosition()),e.map.fitBounds(e.markerBounds),e.map.getZoom()>11&&e.map.setZoom(11))})},e.markerSpinner=function(t){t.exhibit()===!0&&null===t.marker.getPosition()?e.geocode(t):t.exhibit()===!0?(e.markerBounds.extend(t.marker.getPosition()),t.marker.setVisible(!0),e.map.fitBounds(e.markerBounds),e.map.panToBounds(e.markerBounds)):t.marker.setVisible(!1)},e.infoWindowOpener=function(t){e.placeList().forEach(function(e){null!==e.marker.getAnimation()&&e.marker.setAnimation(null)}),e.infowindow.close(),t.marker.setAnimation(google.maps.Animation.BOUNCE);var a=t.access,o=function(e){return"e"===e?"Exterior View":"o"===e?"Public Access":"t"===e?"Access via Tours/Appointments":"p"===e?"Private Residence - No Access":void 0},i=o(a),s=function(e){return e.caseStudy===!0&&"Richard Neutra"!==e.architect?"Case Study Houses":e.architect},r=s(t),n="http://wikipedia.org/w/api.php",c=setTimeout(function(){var a="<p>"+t.name+"</p><p>"+t.address1+", "+t.city+"</p><p>Year Built: "+t.year+"</p><p>Architect(s): "+t.architect+"</p><p>"+i+"</p>(Wikipedia is not responding)";e.infowindow.setContent(a),e.infowindow.open(e.map,t.marker)},3e3);$.ajax({url:n,data:{action:"opensearch",search:r,namespace:0},dataType:"jsonp"}).done(function(a){clearTimeout(c);var o=a,s='<p><a href="'+o[3][0]+'" target="_blank">Wikipedia link</a></p>',r='<div class="infowindow"><p>'+t.name+"</p><p>"+t.address1+", "+t.city+"</p><p>Year Built: "+t.year+"</p><p>Architect(s): "+t.architect+"</p><p>"+i+"</p>"+s+"</div>";e.infowindow.setContent(r),e.infowindow.open(e.map,t.marker)}).fail(function(a){clearTimeout(c);var o='<div class="infowindow"><p>'+t.name+"</p><p>"+t.address1+", "+t.city+"</p><p>Year Built: "+t.year+"</p><p>Architect(s): "+t.architect+"</p><p>"+i+'</p><p class="warning">Wikipedia link failed to load</p></div>';e.infowindow.setContent(o),e.infowindow.open(e.map,t.marker)})},e.showAll=function(){e.decades([]),e.architect([]),e.caseStudy(!1),e.access([]),e.search("")},e.clearMap=function(){e.showAll(),e.placeList().forEach(function(e){e.exhibit(!1)}),e.listScroll(!1),e.noResults(!0),e.setMarkers()},e.updateStyleDecade=function(){e.decades1920(!1),e.decades1930(!1),e.decades1940(!1),e.decades1950(!1),e.decades1960(!1),e.decades1970(!1),e.decades1980(!1),e.decades1990(!1),e.decades2000(!1);for(var t=0,a=e.decades().length;a>t;t++){var o=e.decades()[t];1920==o?e.decades1920(!0):1930==o?e.decades1930(!0):1940==o?e.decades1940(!0):1950==o?e.decades1950(!0):1960==o?e.decades1960(!0):1970==o?e.decades1970(!0):1980==o?e.decades1980(!0):1990==o?e.decades1990(!0):2e3==o&&e.decades2000(!0)}},e.decades.subscribe(e.updateStyleDecade),e.updateStyleArchitect=function(){e.wright(!1),e.schindler(!1),e.neutra(!1),e.lautner(!1),e.gehry(!1);for(var t=0,a=e.architect().length;a>t;t++){var o=e.architect()[t];"Frank Lloyd Wright"===o?e.wright(!0):"Schindler"===o?e.schindler(!0):"Neutra"===o?e.neutra(!0):"Lautner"===o?e.lautner(!0):"Gehry"===o&&e.gehry(!0)}},e.architect.subscribe(e.updateStyleArchitect),e.updateStyleAccess=function(){e["public"](!1),e.tours(!1),e.exterior(!1),e["private"](!1);for(var t=0,a=e.access().length;a>t;t++){var o=e.access()[t];"o"===o?e["public"](!0):"t"===o?e.tours(!0):"e"===o?e.exterior(!0):"p"===o&&e["private"](!0)}},e.access.subscribe(e.updateStyleAccess),e.decades.subscribe(e.evaluateExhibit),e.caseStudy.subscribe(e.evaluateExhibit),e.architect.subscribe(e.evaluateExhibit),e.access.subscribe(e.evaluateExhibit),e.search.subscribe(e.evaluateExhibit),e.isMobile=ko.observable(function(){return window.innerWidth<651?!0:!1}()),e.isLandscape=ko.observable(function(){return window.innerWidth>window.innerHeight?!0:!1}()),e.showSelections=ko.observable(!0),e.selectionDown=ko.computed(function(){return e.isMobile()===!1?void 0:e.isLandscape()===!0?"92.5%":"100%"}),e.selectionUp=ko.computed(function(){return e.isMobile()===!1?void 0:e.isLandscape()===!0?"10%":"50%"}),e.toggleSelections=function(){e.showSelections()===!0?e.showSelections(!1):e.showSelections()===!1&&e.showSelections(!0)},e.screenAdjust=function(){window.innerWidth<651?e.isMobile(!0):e.isMobile(!1),window.innerWidth>window.innerHeight?e.isLandscape(!0):e.isLandscape(!1),e.markerBounds=new google.maps.LatLngBounds,e.placeList().forEach(function(t){t.marker.getVisible()===!0&&e.markerBounds.extend(t.marker.getPosition())}),setTimeout(function(){e.map.fitBounds(e.markerBounds),e.map.getZoom()>11&&e.map.setZoom(11)},200)},$(window).on("resize",function(){e.screenAdjust()}),$(window).on("orientationchange",function(){e.screenAdjust()}),e.firstRun=function(){e.noResultsEval(),e.access(["o","t","e"]),setTimeout(function(){e.listScrollEval()},100)},e.sortPlaces(ajaxList)},startApp=function(){var e=setTimeout(function(){var e=document.createElement("p");e.className="error";var t=document.createTextNode("Error: MyJson.com not responding - Place List unavailable");e.appendChild(t);var a=document.getElementById("container");a.appendChild(e)},3e3);$.ajax({url:"https://api.myjson.com/bins/1n7ut",type:"GET",contentType:"application/json",dataType:"json"}).done(function(t){clearTimeout(e),window.ajaxList=t,ko.applyBindings(new ViewModel)}).fail(function(t){clearTimeout(e);var a=document.createElement("p");a.className="error";var o=document.createTextNode("Error: MyJson.com was not able to deliver place list");a.appendChild(o);var i=document.getElementById("container");i.appendChild(a)})},errorCall=function(){var e=document.createElement("p");e.className="error";var t=document.createTextNode("Error: Google Map API failed to load");e.appendChild(t);var a=document.getElementById("container");a.appendChild(e)};